<!doctype html>
<html>
  <head>
    <title>Test Frontend Logowania</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <h1>Test Frontend Logowania</h1>
    <button onclick="testFrontendLogin()">Test Frontend Login</button>
    <div id="result"></div>

    <script>
      // Symuluj Zustand store
      let authState = {
        user: null,
        token: null,
        isAuthenticated: false,
        isLoading: false,
        error: null,
      };

      function setState(newState) {
        authState = { ...authState, ...newState };
        console.log("üîÑ Nowy stan:", authState);
        updateUI();
      }

      function updateUI() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = `
                <h3>Stan Auth:</h3>
                <p>Authenticated: ${authState.isAuthenticated ? "‚úÖ" : "‚ùå"}</p>
                <p>User: ${authState.user?.email || "None"}</p>
                <p>Role: ${authState.user?.role || "None"}</p>
                <p>Loading: ${authState.isLoading ? "‚è≥" : "‚úÖ"}</p>
                <p>Error: ${authState.error || "None"}</p>
            `;
      }

      async function testFrontendLogin() {
        console.log("üöÄ Rozpoczynam test frontend logowania...");

        setState({ isLoading: true, error: null });

        try {
          console.log("üîê Pr√≥ba logowania: organizer@athletics.pl");

          const response = await axios.post(
            "http://localhost:3001/auth/login",
            {
              email: "organizer@athletics.pl",
              password: "password123",
            },
            {
              withCredentials: true,
            }
          );

          console.log("üç™ Sprawdzam cookies po logowaniu:", document.cookie);

          const { user, token } = response.data;

          console.log("‚úÖ Logowanie udane:", {
            user: user.email,
            role: user.role,
          });

          const newState = {
            user,
            token,
            isAuthenticated: true,
            isLoading: false,
            error: null,
          };

          console.log("üîÑ Ustawiam nowy stan:", newState);
          setState(newState);

          // Sprawd≈∫ czy stan zosta≈Ç ustawiony
          setTimeout(async () => {
            console.log("üìä Aktualny stan po logowaniu:", authState);

            // Test API profilu z cookies
            try {
              console.log("üîç Testujƒô API profilu z cookies...");
              const profileResponse = await axios.get(
                "http://localhost:3001/auth/profile",
                {
                  withCredentials: true,
                }
              );
              console.log("‚úÖ API profilu dzia≈Ça:", profileResponse.data);
            } catch (error) {
              console.log(
                "‚ùå API profilu nie dzia≈Ça:",
                error.response?.status,
                error.response?.data
              );
            }

            if (authState.isAuthenticated && authState.user) {
              console.log("‚úÖ Przekierowujƒô do dashboard...");
              setTimeout(() => {
                window.location.href = "http://localhost:3000/dashboard";
              }, 1000);
            } else {
              console.log(
                "‚ùå U≈ºytkownik nie jest zalogowany, nie przekierowujƒô"
              );
            }
          }, 100);
        } catch (error) {
          console.error(
            "‚ùå B≈ÇƒÖd logowania:",
            error.response?.data || error.message
          );
          setState({
            isLoading: false,
            error: error.response?.data?.message || "B≈ÇƒÖd logowania",
            isAuthenticated: false,
          });
        }
      }

      // Inicjalizuj UI
      updateUI();
    </script>
  </body>
</html>
